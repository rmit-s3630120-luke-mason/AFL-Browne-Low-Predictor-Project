---
title: "AFL Modelling of Performance Per Game"
output: html_notebook
---
```{r}
source("../../utilities/Model2Scripts.R")

# Read train and test sets from files.
train <- read.csv("../../data/train_performance.csv")
test <- read.csv("../../data/test_performance.csv")

var_col_count <- 22
```

# Load save
```{r}
load_run_state(4)
load(file=paste('Run2.RData'))
```

### JAGS Run 1
```{r}
# Run 1
run_number <- 1

# Hyper Parameters
adaptSteps = 50
burnInSteps = 100
nChains = 2
thinSteps = 17
numSavedSteps = 250

# Run JAGS
codaSamples <- run_jags_model_2(train, test, var_col_count, run_number = run_number, adaptSteps = adaptSteps, burnInSteps = burnInSteps, nChains = nChains, thinSteps = thinSteps, numSavedSteps = numSavedSteps)

# Save State
save_run_state(codaSamples, run_number)

# Diagnostics
summaryInfo <- generate_diagnostics(codaSamples, run_number, var_col_count, TRUE)

# Leader Board
create_leaderboard(test, summaryInfo, var_col_count)
```

### JAGS Run 2
```{r}
# Run 2
run_number <- 2

# Hyper Parameters
adaptSteps = 675
burnInSteps = 1250
nChains = 2
thinSteps = 20
numSavedSteps = 2500

# Run JAGS
codaSamples <- run_jags_model_2(train, test, var_col_count, run_number = run_number, adaptSteps = adaptSteps, burnInSteps = burnInSteps, nChains = nChains, thinSteps = thinSteps, numSavedSteps = numSavedSteps)

# Save State
save_run_state(codaSamples, run_number)

# Diagnostics
summaryInfo <- generate_diagnostics(codaSamples, run_number, var_col_count, TRUE)

# Leader Board
create_leaderboard(test, summaryInfo, var_col_count)
```

### JAGS Run 3
```{r}
# Run 3
run_number <- 3

# Hyper Parameters
adaptSteps = 675
burnInSteps = 5000
nChains = 4
thinSteps = 40
numSavedSteps = 4000

# Run JAGS
codaSamples <- run_jags_model_2(train, test, var_col_count, run_number = run_number, adaptSteps = adaptSteps, burnInSteps = burnInSteps, nChains = nChains, thinSteps = thinSteps, numSavedSteps = numSavedSteps)

# Save State
save_run_state(codaSamples, run_number)

# Diagnostics
summaryInfo <- generate_diagnostics(codaSamples, run_number, var_col_count, TRUE)

# Leader Board
create_leaderboard(test, summaryInfo, var_col_count)
```

### JAGS Run 4
```{r}
# Run 3
run_number <- 4

# Hyper Parameters
adaptSteps = 675
burnInSteps = 20000
nChains = 4
thinSteps = 40
numSavedSteps = 4000

# Run JAGS
codaSamples <- run_jags_model_2(train, test, var_col_count, run_number = run_number, adaptSteps = adaptSteps, burnInSteps = burnInSteps, nChains = nChains, thinSteps = thinSteps, numSavedSteps = numSavedSteps)

# Save State
save_run_state(codaSamples, run_number)

# Diagnostics
summaryInfo <- generate_diagnostics(codaSamples, run_number, var_col_count, TRUE)

# Leader Board
create_leaderboard(test, summaryInfo, var_col_count)
```

# Run Performance Analysis
```{r}
performance_test <- function (predictions) {
  real = c(test$Brownlow.Votes)
  length(predictions)
  length(real)
  n = length(real)
  print(paste("MAE:", sum(abs(predictions - real))/n))
  print(paste("MSE:", sum((real - predictions)^2)))
  print(paste("RMSE:", sqrt(mse/n)))
}

performance_test(pred)
```
