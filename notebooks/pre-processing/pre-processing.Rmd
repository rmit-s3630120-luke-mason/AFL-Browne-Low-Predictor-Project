---
title: "AFL Browne-Low Raw Stats, Analytics, and Pre Processing"
output: html_notebook
---
This project was conducted by Thomas Johnstone, Richard, and Luke Mason, with supervision from RMIT Lecturer Dr Haydar Demirhan Bayesian Statistics 2022.


This R Notebook is responsible for pre processing the AFL stats so that they can be consumed by the JAGS model.




##### Import Packages and source code
These are the necessary packages and code needed to run the following code samples.
```{r}
library(flipAPI)
```


## Load in the Raw Stats
```{r}
raw_stats = read.csv("../../data/raw_stats.csv")
```




```{r}
# Sort by playerid first, then by round, so players are grouped together first, then their rounds they played over the years they played for that round.
attach(raw_stats)
sorted_raw_stats = raw_stats[order(playerId, round),]
sorted_raw_stats
```
Create the list of round names
```{r}
rounds <- c()
for (num in 1:21) {
  rounds <- c(rounds, paste("R", num, sep=""))
}
rounds
```

# Richard's attempt
```{r}
```

# Lukes current attempt at aggregating each players stats for each round from every year
```{r}
# Get the row indices of the playerid
i <- 0
all_indices_ranges <- c()

current_indicies

# Initial id is id of the first row.
currentId <- sorted_raw_stats$playerId[1]
for (row in 1:nrow(raw_stats)) {
    id <- raw_stats[row, "playerId"]
    
    # If new player or end of the list, collect the data and add row to new table (dataframe).
    if (currentId != id) {
      # Aggregate the row ???
      
      
      # Add row to dataframe representing that player aggregated ??
      
      currentId <- id
      current_df = c()
    }
    
    # For every field aggregate the stats
    for (col_num in 1:ncol(raw_stats)) {
      
      # For each round aggregate the field statistics.
      for(round in rounds) {
        
      }
      
    }
    
}
 
# For each field

# Average over the years

raw_stats
```

Attempt 2
```{r}
second = function(x) {
            if (length(x) == 1)
                return(x)
            return(sort(x, decreasing = TRUE)[2])}

agg = aggregate(raw_stats,
                by = list(raw_stats$playerId, raw_stats$round),
                FUN = second)
agg

agg <- aggregate(Kicks ~ round + playerId, data=raw_stats, FUN="mean")
agg["Bounces"] <- aggregate(Bounces ~ round + playerId, data=raw_stats, FUN="mean")[3]

agg
```
Behinds, Bounces, Brownlow.Votes, Clangers, Clearances, Contested.Marks, Contested.Possessions,
    displayName, Disposals, Frees, Frees.Against, gameId, gameNumber, Goal.Assists, Goals, Handballs,
    Hit.Outs, Inside.50s, Kicks, Marks, Marks.Inside.50, One.Percenters, playerId, Rebounds, round, Subs,
    Tackles, team, Uncontested.Possessions, X..Played, year
    
```{r}
attach(raw_stats)
df[, list(mean()), by=list(playerId,round)] 
```





Try this

https://stackoverflow.com/questions/14640668/transforming-data-frame-in-r







